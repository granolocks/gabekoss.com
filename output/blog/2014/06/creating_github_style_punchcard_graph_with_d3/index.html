<!doctype html>
<html>
  <head>
    <title>Creating Github Style Punchcard Graph with D3</title>
<link type='text/css' href='/style.css' rel='stylesheet'/> <link rel="stylesheet" href="/css/zenburn.css">
<meta property="og:title" content="Creating Github Style Punchcard Graph with D3" />
<meta property="og:url" content="http://www.gabekoss.com/blog/2014/06/creating_github_style_punchcard_graph_with_d3/" />
<meta property="og:type" content="website" />
<meta property="og:description" content="" />
<meta property="og:image" content="http://www.gabekoss.com/images/og.png" />

  <script src="/js/highlight-pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

<!--                                                                                              -->
<!--       ___ ___         .__  .__           ___________      .__                   .___._.      -->
<!--      /   |   \   ____ |  | |  |   ____   \_   _____/______|__| ____   ____    __| _/| |      -->
<!--     /    ~    \_/ __ \|  | |  |  /  _ \   |    __) \_  __ \  |/ __ \ /    \  / __ | | |      -->
<!--     \    Y    /\  ___/|  |_|  |_(  <_> )  |     \   |  | \/  \  ___/|   |  \/ /_/ |  \|      -->
<!--      \___|_  /  \___  >____/____/\____/   \___  /   |__|  |__|\___  >___|  /\____ |  __      -->
<!--            \/       \/                        \/                  \/     \/      \/  \/      -->
<!--                                                                                              -->
<!--                                                                                              -->
<!--     My sweet site was generated using love, ruby & nanoc [http://nanoc.ws/]                  -->
<!--                                                                                              -->
<!--                                                                                              -->
<!--     "Anytime I see something screech across a room and latch onto someones neck,             -->
<!--     and the guy screams and tries to get it off, I have to laugh,                            -->
<!--     because what is that thing?"                                                             -->
<!--                                                                                              -->
<!--                           - Jack Handy                                                       -->
<!--                                                                                              -->

  </head>
  <body>
    <div id="sidebar">
      <ul>
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/notes">Notes</a></li>
  <li><a href="/tags">Search</a></li>
</ul>
<div class="img-links">
  <a href="https://github.com/granolocks"><img src="/images/github.png"></a>
  <a href="https://twitter.com/granolocks"><img src="/images/twitter.png"></a>
  <div style="clear:both"></div>
</div>

    </div>
    <div id="main">
      
      
      
        <p>
          <small>
            
              <a href='/blog/2014/04/first_experiments_with_blender/' title='First Experiments with Blender'>&#8656; Previous</a>
            
             
            
          </small> 
        </p>
        <h1>Creating Github Style Punchcard Graph with D3</h1>
        <p><em>Post created 2014-06-19 21:20 by Gabe Koss.<br/></em></p>
        <script src="/js/d3-v3-min.js" charset="utf-8"></script>

<script src="/js/jquery-1-10-1-min.js"></script>

<style type="text/css">
  #graph-wrapper {
    width: 115%;
    padding: 10px;
    background-color: rgba(20, 20, 20,0.2); 
    } 
  .hover-circle:hover { fill: grey; }
</style>

<p>I really like the <a href="https://github.com/granolocks/gabekoss.com/graphs/punch-card">punchcard
graphs</a> which
Github produces. They are a cool way to get a perspective on how you have been
working on a given codebase. </p>

<p>At the completion of a recent project which covered several different codebases
I was curious to see what that would look like in aggregate so, in order to
continue (slowly) progressing with <code>d3.js</code>, I created the following graph: </p>

<div id="graph-wrapper">
  <div id="graph"></div>
</div>

<script src="/js/d3-github-punchcard.js"></script>

<h2>Process</h2>

<p>For the curious here is how I created this graph: </p>

<h3>1. Gather Data</h3>

<p>I pulled the raw data from Github directly. This is quite easy to do, simple
append <code>/graphs/punch-card-data</code> to any github repo url. The link for the graph
for this website is located at:</p>

<blockquote>
<p><code>https://github.com/granolocks/gabekoss.com/graphs/punch-card</code></p>
</blockquote>

<p>This data takes the form of an Array of Arrays containing 3 elements each</p>

<pre><code> [
   &lt;0-6&gt;  : Day of Week, Y Axis Value,
   &lt;0-23&gt; : Hour of Day, X Axis Value,
   &lt;n&gt;    : Number of commits, Z Axis Value / Circle weight
  ]
</code></pre>

<p>In other words, the data looks like this: </p>

<pre><code class="json">[
  [0,0,0], [0,1,0], [0,2,0], [0,3,0], [0,4,0], [0,5,5],
  [0,6,4], [0,7,1], [0,8,2], [0,9,4], [0,10,0], [0,11,3],

  // you get the idea...

  [6,12,4], [6,13,15], [6,14,7], [6,15,6], [6,16,7], [6,17,24],
  [6,18,7], [6,19,13], [6,20,4], [6,21,8], [6,22,1], [6,23,1]]
]
</code></pre>

<h3>2. Combine the Arrays</h3>

<p>I pasted all the graph data blobs for each repo into a little ruby script and
put them all inside a big array called <code>DATA</code> This is the script I used to
generate the graph:</p>

<pre><code class="ruby">require &#39;json&#39;

DATA = [ 
 # [ ... ],
 # [ ... ],
 # [ ... ]
]

def combine
  empty_counter = []
  (0..6).to_a.each do |day|
    (0..23).to_a.each do |hour|
      empty_counter &lt;&lt; [day,hour,0]
    end
  end

  DATA.inject(empty_counter) do |counter,data|
    data.each_with_index do |tpl,index|
      counter[index][2] += tpl[2]
    end
    counter
  end
end

File.write(&#39;combined.json&#39;, JSON.generate(combine))
</code></pre>

<p>In the <code>combined.json</code> output file I now had a single data set which still
mapped the first element to day, second element to the hour but with the third
element in each tuple containing sum total count of commits during that
day/hour.</p>

<h3>D3</h3>

<p>After dropping the JSON file onto a public path I added the following markup:</p>

<pre><code class="html">&lt;script src=&quot;/js/d3-v3-min.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/jquery-1-10-1-min.js&quot;&gt;&lt;/script&gt;

&lt;style type=&quot;text/css&quot;&gt;
  #graph-wrapper {
    width: 115%;
    padding: 10px;
    background-color: rgba(20, 20, 20,0.2); 
    } 
  .hover-circle:hover { fill: grey; }
&lt;/style&gt;

&lt;div id=&quot;graph-wrapper&quot;&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;/js/d3-github-punchcard.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p>In the <code>/js/d3-github-punchcard.js</code> file I placed the following script body.
It&#39;s a bit rough but it got the job done.</p>

<pre><code class="javascript">var fullWidth = document.getElementById(&#39;graph&#39;).offsetWidth;
var graphPadding = 80;
var width = (fullWidth-graphPadding);
var fullHeight = 380;
var height = (fullHeight-30);
var days = [
  &quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;,
  &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;
];
var hours = [
  &quot;12am&quot;, &quot;1am&quot;, &quot;2am&quot;, &quot;3am&quot;, &quot;4am&quot;, &quot;5am&quot;, &quot;6am&quot;, &quot;7am&quot;, &quot;8am&quot;,
  &quot;9am&quot;, &quot;10am&quot;, &quot;11am&quot;, &quot;12pm&quot;, &quot;1pm&quot;, &quot;2pm&quot;, &quot;3pm&quot;, &quot;4pm&quot;, &quot;5pm&quot;,
  &quot;6pm&quot;, &quot;7pm&quot;, &quot;8pm&quot;, &quot;9pm&quot;, &quot;10pm&quot;, &quot;11pm&quot;
];


var palette = d3.select(&quot;#graph&quot;).append(&quot;svg&quot;).
  attr(&quot;width&quot;, fullWidth).
  attr(&quot;height&quot;, fullHeight);

var dayGroup = palette.append(&quot;g&quot;);
var hourGroup = palette.append(&quot;g&quot;);
var circleGroup = palette.append(&quot;g&quot;);


$(document).ready(function(){
  $.getJSON(&#39;/json/d3-github.json&#39;, function(data){

    x = {
      min:  0,
      max:  width
    }
    x.step = x.max/24;

    y = {
      min:  0,
      max:  height
    }
    y.step = y.max/7;

  var dayText = dayGroup.selectAll(&quot;text&quot;)
                          .data(days)
                          .enter()
                          .append(&quot;text&quot;);
  var dayLabels = dayText
                   .attr(&quot;x&quot;, 0)
                   .attr(&quot;y&quot;, function(d) { return y.step*(days.indexOf(d)+1); })
                   .text(function (d) { return d; })
                   .attr(&quot;font-family&quot;, &quot;sans-serif&quot;)
                   .attr(&quot;font-size&quot;, &quot;12px&quot;);

  var hourText = hourGroup.selectAll(&quot;text&quot;)
                          .data(hours)
                          .enter()
                          .append(&quot;text&quot;);
  var hourLabels = hourText
                   .attr(&quot;x&quot;, function(d) {
                     return x.step*(hours.indexOf(d)+1)+32;
                   })
                   .attr(&quot;y&quot;, y.max+20)
                   .text(function (d) { return d; })
                   .attr(&quot;font-family&quot;, &quot;sans-serif&quot;)
                   .attr(&quot;font-size&quot;, &quot;12px&quot;);


  var scaleData = [];

  for (i in data){
    scaleData.push(data[i][2])
  }

  z = {
    data: scaleData
  }
  z.max    = d3.max(z.data)
  z.min    = d3.min(z.data)
  z.domain = [z.min, z.max]
  z.range  = [4, 15]
  z.scale  = d3.scale.linear().
  domain(z.domain).
  range(z.range);

  for (var i in data) {
    tuple = data[i];
    commits = tuple[2];
    if (commits &gt; 0) {
      cy    = y.step*(tuple[0]+1);
      cx    = x.step*(tuple[1]+1)+50;
      r     = z.scale(commits);
      title = &quot;Commits: &quot; + commits;

      c = circleGroup.append(&quot;circle&quot;)
        .attr(&quot;cx&quot;,cx)
        .attr(&quot;cy&quot;,cy)
        .attr(&quot;r&quot;,r)
        .attr(&quot;title&quot;,title)
        .attr(&quot;class&quot;,&quot;hover-circle&quot;);

      }
    }

  })
});
</code></pre>

        <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'gabekoss'; 

(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      
    </div>
    <div id="footer">
      <hr/>
<p>&copy; 2014 <a href="mailto:gabe@gabekoss.com">Gabe Koss</a></p>

  <p><small>Last updated at: 2014-06-19 21:20</small></p>


    </div>
  </body>
   
  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12795044-1']);
  _gaq.push(['_setDomainName', 'gabekoss.com']);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();
</script>

</html>

