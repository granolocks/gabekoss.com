<!doctype html>
<html>
  <head>
    <title>Graphing Bitcoin data with D3.js</title>
<link type='text/css' href='/style.css' rel='stylesheet'/> <link rel="stylesheet" href="/css/zenburn.css">
<meta property="og:title" content="Graphing Bitcoin data with D3.js" />
<meta property="og:url" content="http://www.gabekoss.com/blog/2013/12/graphing_bitcoin_data_with_d3_js/" />
<meta property="og:type" content="website" />
<meta property="og:description" content="The result of helping my friend play with some of his bitcoin data." />
<meta property="og:image" content="http://www.gabekoss.com/images/og.png" />

  <script src="/js/highlight-pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

<!--                                                                                              -->
<!--       ___ ___         .__  .__           ___________      .__                   .___._.      -->
<!--      /   |   \   ____ |  | |  |   ____   \_   _____/______|__| ____   ____    __| _/| |      -->
<!--     /    ~    \_/ __ \|  | |  |  /  _ \   |    __) \_  __ \  |/ __ \ /    \  / __ | | |      -->
<!--     \    Y    /\  ___/|  |_|  |_(  <_> )  |     \   |  | \/  \  ___/|   |  \/ /_/ |  \|      -->
<!--      \___|_  /  \___  >____/____/\____/   \___  /   |__|  |__|\___  >___|  /\____ |  __      -->
<!--            \/       \/                        \/                  \/     \/      \/  \/      -->
<!--                                                                                              -->
<!--                                                                                              -->
<!--     My sweet site was generated using love, ruby & nanoc [http://nanoc.ws/]                  -->
<!--                                                                                              -->
<!--                                                                                              -->
<!--     "Anytime I see something screech across a room and latch onto someones neck,             -->
<!--     and the guy screams and tries to get it off, I have to laugh,                            -->
<!--     because what is that thing?"                                                             -->
<!--                                                                                              -->
<!--                           - Jack Handy                                                       -->
<!--                                                                                              -->

  </head>
  <body>
    <div id="sidebar">
      <ul>
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/notes">Notes</a></li>
  <li><a href="/tags">Search</a></li>
</ul>
<div class="img-links">
  <a href="https://github.com/granolocks"><img src="/images/github.png"></a>
  <a href="https://twitter.com/granolocks"><img src="/images/twitter.png"></a>
  <div style="clear:both"></div>
</div>

    </div>
    <div id="main">
      
      
      
        <p>
          <small>
            
              <a href='/blog/2013/12/my_nanowrimo_stats/' title='My NaNoWrimo Stats'>&#8656; Previous</a>
            
             | 
            
              <a href='/blog/2013/12/5_important_things_i_have_learned_in_a_startup/' title='5 important things I have learned in a startup'>Next &#8658;</a>
            
          </small> 
        </p>
        <h1>Graphing Bitcoin data with D3.js</h1>
        <p><em>Post created 2013-12-23 14:44 by Gabe Koss.<br/></em></p>
        <script src="/js/d3-v3-min.js" charset="utf-8"></script>

<script src="/js/jquery-1-10-1-min.js"></script>

<style type="text/css">
  #graph-wrapper {
    padding: 10px;
    background-color: rgba(20, 20, 20,0.2); 
    } 
</style>

<p>A technology I have been curious to experiment with lately is <a href="http://d3js.org/">D3.js</a> a
Javsascript graphing library using SVGs. A friend was looking for a little
assistance creating a graph of the prices of bitcoins over time and I decided
to try it out with D3. </p>

<h2>The Data</h2>

<p>The data coming in was JSON data containing a <code>time</code> key with a Unix timestamp
and a <code>last</code> key containing the last see price at that moment.</p>

<pre><code class="json">[ {&quot;time&quot;:1387774950.180666,&quot;last&quot;:678.94998}, 
  ... 
  {&quot;time&quot;:1387809762.27258,&quot;last&quot;:670.0} ]
</code></pre>

<h2>The Graph</h2>

<p>Before digging into the code for this its nice to show the finished product.
Here is the graph I ended up with:</p>

<div id="graph-wrapper">
  <div id="graph"></div>
</div>

<p>It is worth noting that the X Axis times are static as this was built from a
<a href="/json/trade_data.json">static json file</a>.</p>

<h2>The Code</h2>

<h3>Markup</h3>

<p>The markup for this is very simple.</p>

<p><strong>Include the JS</strong></p>

<pre><code class="html">&lt;script src=&quot;/js/d3-v3-min.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/jquery-1-10-1-min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/d3_bitcoin.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p><strong>Some simple styles</strong></p>

<pre><code class="css">#graph-wrapper { 
  padding: 10px; 
  background-color: rgba(20, 20, 20,0.2); 
} 
</code></pre>

<p><strong>Element where the graph will live</strong></p>

<pre><code class="html">&lt;div id=&quot;graph-wrapper&quot;&gt;
  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<h3>Set document variables</h3>

<p>These are some helpful definitions which will be used throughout the script
which builds the graph.</p>

<pre><code class="js">// Padding on left of graph
var graphPadding = 60;

// Width of SVG palette and of graph, respectively
var fullWidth = document.getElementById(&#39;graph&#39;).offsetWidth;
var width = (fullWidth-graphPadding);

// Height of SVG palette and of graph, respectively
var fullHeight = 320;
var height = (fullHeight-20);
</code></pre>

<h3>Set up containers</h3>

<p>Next, I added an SVG to <code>div#graph</code>. I stored this as <code>palette</code> and it has the
dimensions of <code>fullHeight</code> x <code>fullWidth</code>.</p>

<pre><code class="js">// palette to draw graph and elements
var palette = d3.select(&quot;#graph&quot;).append(&quot;svg&quot;).
  attr(&quot;width&quot;, fullWidth).
  attr(&quot;height&quot;, fullHeight);

// secondary svg to hold graph, slightly smaller than palette
var lineContainer = palette.append(&quot;g&quot;).
  attr(&quot;x&quot;, graphPadding).
  attr(&quot;height&quot;, height).
  attr(&quot;width&quot;, width);

// Other groups
var edgeGroup = palette.append(&quot;g&quot;);
var lineGroup = palette.append(&quot;g&quot;);
</code></pre>

<h3>Get the Data</h3>

<p>The data for this request is being loaded from <code>/json/trade_data.json</code> and so I
used jQuery to pull this in  with <code>$.getJSON</code>. This is passed to the function
as the <code>data</code> argument.</p>

<pre><code class="js">$(document).ready(function(){
  // Get the data and do the thing
  $.getJSON(&#39;/json/trade_data.json&#39;, function(data){
    // 
    // All code goes here
    // 
  }
}
</code></pre>

<p>Everything after this point was placed inside the function block. </p>

<h3>Split Data</h3>

<p>My approach was to split the array of hashes into two sequenced arrays called
<code>time</code> and `last. </p>

<pre><code class="js">var time = [];
var last = [];

$(data).each(function(i,tick){
  time.push(tick.time);
  last.push(tick.last);
});
</code></pre>

<h3>Set up X and Y coords</h3>

<p>There are many ways to do this, but since I was only graphing a single set of
data with two dimensions I bound these strongly to the coordinate systems. I
created <code>x</code> and <code>y</code> objects to handle processing related to <code>time</code> and <code>last</code>
respectively.</p>

<pre><code class="js">var x = {};
x.data   = time;
</code></pre>

<p>Set up a min and max to use for our graph domain and other purposes. This uses
the helpers <code>d3.min()</code> and d3.max()<code>and passes in the</code>time` data as the
argument.</p>

<pre><code class="js">x.min    = d3.min(x.data);
x.max    = d3.max(x.data);
</code></pre>

<p>Set up the range for the x axis. This range is very important to creating the
graph and requires a bit of setup. It needs a <code>domain</code> which is the data range
that it is responsible for covering. In this case I used <code>x.min</code> and <code>x.max</code>.</p>

<p>It also needs a <code>range</code> which is the range of values which to map the data
domain to. In this case it is the area covered by the graph on the x-axis: the
<code>graphPadding</code> value to the <code>fullWidth</code> value.</p>

<pre><code class="js">x.domain = [x.min, x.max];
x.range  = [graphPadding, fullWidth]; 
x.scale  = d3.scale.linear().
              domain(x.domain).
              range(x.range);
</code></pre>

<p>Define a time range axis to display to the user. To keep all this data together
I placed in a sub boject.</p>

<pre><code class="js">x.axis   = {
  min: new Date(x.min*1000),
  max: new Date(x.max*1000)
}
x.axis.scale = d3.time.scale().
                  domain([x.axis.min,x.axis.max]).
                  range(x.range);
x.axis.axis  = d3.svg.axis().
                  scale(x.axis.scale).
                  orient(&quot;bottom&quot;);
</code></pre>

<p>The <code>y</code> object I used is fairly similar to the <code>x</code> although a bit simpler.</p>

<pre><code>var y = {};
y.data   = last;
y.min    = d3.min(y.data);
y.max    = d3.max(y.data);
y.domain = [y.max, y.min];
y.range  = [0, height];
y.scale  = d3.scale.linear().
              domain(y.domain).
              range(y.range);
y.axis   = {
  axis: d3.svg.axis().
           scale(y.scale).
           orient(&quot;left&quot;);
}
</code></pre>

<h3>Add X and Y axis objects</h3>

<p>I use the <code>d3.svg.axis</code> objects which were created as part of the <code>x</code> and <code>y</code>
setup to create the scales on the left and bottom of the graph. Notice how
these are appended to the <code>edgeGroup</code> and have to be moved around with
<code>transform</code> operations.</p>

<pre><code class="js">edgeGroup.append(&quot;g&quot;).
  attr(&quot;stroke-width&quot;, 1).
  attr(&quot;transform&quot;, &quot;translate(&quot;+graphPadding+&quot;,0)&quot;).
  attr(&quot;class&quot;, &quot;axis&quot;).
  call(y.axis.axis);

edgeGroup.append(&quot;g&quot;).
  attr(&quot;transform&quot;, &quot;translate(0,&quot;+(fullHeight-20)+&quot;)&quot;).
  attr(&quot;class&quot;, &quot;axis&quot;).
  call(x.axis.axis);

edgeGroup.selectAll(&#39;.axis path&#39;).
  style({
    &#39;stroke&#39;: &#39;#000&#39;,
    &#39;fill&#39;: &#39;none&#39;,
    &#39;stroke-width&#39;: &#39;1px&#39;
  });
</code></pre>

<h3>Add the Line</h3>

<p>The final step is to append a <code>svg:path</code> to the <code>lineGroup</code>. This path is
rendered in the <code>lineFunction</code>. </p>

<pre><code class="js">var lineFunction = d3.svg.line()
  .y(function(d,i) { return y.scale(y.data[i]); })
  .x(function(d,i) { return x.scale(x.data[i]); })
  .interpolate(&quot;basis&quot;);

var lineGraph = lineGroup.append(&quot;svg:path&quot;).
  attr(&quot;d&quot;, lineFunction(data)).
  attr(&quot;stroke&quot;, &quot;#000&quot; ).
  attr(&quot;stroke-width&quot;, 1).
  attr(&quot;fill&quot;, &quot;none&quot;);
</code></pre>

<script src="/js/d3_bitcoin.js"></script>

        <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'gabekoss'; 

(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      
    </div>
    <div id="footer">
      <hr/>
<p>&copy; 2013 <a href="mailto:gabe@gabekoss.com">Gabe Koss</a></p>

  <p><small>Last updated at: 2013-12-23 14:44</small></p>


    </div>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12795044-1']);
  _gaq.push(['_setDomainName', 'gabekoss.com']);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();
</script>

  </body>
</html>

